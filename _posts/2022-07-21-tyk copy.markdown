---
layout: single
#classes: wide
title:  "IIS"
date:   2022-07-21 10:29:50 +0800
categories: iis,dispatcher,aem
allow_different_nesting: true
toc: true
toc_label: "In this page"
toc_icon: " "
toc_sticky: true
sidebar:
  nav: "about"
---

## IIS

* all iis configuration will be consolidated and store in c:/windows/system32/inetsrv/conf/applicationhost.config
  * make sure all the config is correct

## Dispatcher

* make sure hash value for each of the dll below is correct as below (run powershell command get-filehash <dll> to verify)

| dispatcher version | dll          | hash                                                             |
| :----------------- | :----------- | :--------------------------------------------------------------- |
| 4.3.3              | disp_iis.dll | 12F1FD3C47C7522981C8743F8C7586A25B68FCDD64EB2569DC2044870EE07B32 |
| 4.3.3              | libeay32.dll | A43DC96D5F69E697666B5AC316CB6B2570E27F7F539AB899B86211513C5B5EF4 |
| 4.3.3              | ssleay32.dll | F5F3ED144C6B4A8CA0C1486155534F29399DF78088F05BC8CFDFE3E372E1F67C |

* create ssl for each application server - pending ssl creation by TA
* ensure web server can hit application server by port 443 (need TA to open firewall)
test-netconnection -ComputerName `<application server>` -Port 443
* make sure IIS(World Wide Web Publishing) is installed with features below

```txt
Web Server > Common HTTP Features > Default Document
Web Server > Common HTTP Features > HTTP Errors
Web Server > Common HTTP Features > Static Content
Web Server > Health and Diagnostics > HTTP Logging
Web Server > Health and Diagnostics > Tracing
Web Server > Performance > Static Content Compression
Web Server > Security > Request Filtering
Web Server > Security > IP and Domain Restrictions
Web Server > Security > URL Authorization
Web Server > Application Development > CGI
Web Server > Application Development > ISAPI Extensions
Web Server > Application Development > ISAPI Filters
Management Tools > IIS Management Console
```

* make sure IIS(World Wide Web Publishing) is running as window service (automatic)

### Enable Self Signed Certificate on IIS - this is a temporary steps until the real certificate is generated by TA

* select home
* select Server certificates
* select create self signed certificates
friendly name: `<same as hostname>`
store: `<web hosting>`

### Troubleshooting

#### cannot hit aem via dispatcher url (MapRequestHandler ... undetermined file handler)

* local working version is showing `ExecuteRequestHandler` if got issue, why dev env is `MapRequestHandler`???
* enable `failed request tracing`(windows features)
* config in website, hit dispatcher url > get 404.4 > not even logging into `FailedRequestLog` folder
* took the applicationHost.config and compare to a working dispatcher server and notice that 2 issus
  * applicationhost.config has
    * duplicate virtualhost (one that points to docroot and one that points to `Script` folder)
      * remove `Script` setting
    * `applicationPoolDefaults` settings too complicated

```config
...
    <system.applicationHost>

        <applicationPools>
            <add name="DNSWebOnline" />
            <applicationPoolDefaults managedRuntimeVersion="v4.0">
                <processModel identityType="ApplicationPoolIdentity" loadUserProfile="true" setProfileEnvironment="false" />
            </applicationPoolDefaults>
        </applicationPools>
        ...
```

* restart IIS and manage to hit dispatcher url
