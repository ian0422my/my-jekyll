---
layout: single
#classes: wide
title:  "Cryptography"
date:   2021-09-28 18:31:50 +0800
categories: cryptography, ssl, certificate, tls
toc: true
toc_label: "In this page"
toc_icon: " "
toc_sticky: true
sidebar:
  nav: "about"
---

## terminology

* ca
  * generate certificate
* root ca
  * generate root cert
  * store offline
* intermediate ca
  * generate intermediate cert using root cert
    * by verifying the website domain(e.g. www.abc.com) is indeed owned by company abc
  * host website(using intermediate cert) to allow client to self service
    * revoke old/compromised one
    * create new one
  * in the event where intermidiate cert is compromised, root ca just need to regen intermiedaite cert - no need to ask chrome to add new root ca into chrome
* leaf ca
  * no such thing; but should be the owner of the leaf cert
  * consists of information such as public key, company info, issuer, validity
* root cert
  * generated by root ca
  * store offline
  * inconvenient
    * if root cert is comprosised, root CA need to convince software like Chrome to add the new root cert as trusted ca - alot of paper work and google need to push the new browser - not all user update their chrome frequently
    * that's why root cert is not generally used to generate normal cert (they used intermediate cert)
  * secure
    * incase intermediate cert is compromised, client can revoke old cert/generaet new one online
* trusted ca
  * all softwares has a list of predefined trusted root ca
  * changes in root ca will normally new release of software/patchs
* certificate chain
  * relationship between root cert, intermiediate cert and leaf cert(client cert)
* certificate signature
  * hash value/signature to prove certificate ownership
* certificate signature request/csr
  * raw cert send by client to intermidiate ca to sign the cert
* ssl/tls handshake
  * process where software(chrome) used to
    * check a cert validity (owner, validity, trustworthy)
    * transact by encryption using public key
* openssl - software library
* certutil(windows only) - can be used to inspect certificate (windows only)

## Summary

| Type     | acronym          | name                                                                                | desc                                                                                                                                                                                                       |
| :------- | :--------------- | :---------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| language | asn              | Abstract Syntax Notation One (ASN.1)                                                | standard interface description language for defining data structures that can be serialized and deserialized in a cross-platform way                                                                       |
| standard | X509             | -                                                                                   | series of standards;  format of public key certificates; structed; extensions include pem, cer, crt, der, p7b, p7c, p12, pfx                                                                               |
| syntax   | der              | Distinguished Encoding Rules                                                        | binary container format of PEM; parent of PEM                                                                                                                                                              |
| format   | pem              | privacy enhanced mail                                                               | ***container*** format; base64; text; "-----BEGIN-----" and "-----END-----"; may include public cert; may include pub, pri, root ca, cert chain; can encode CSR(since openssl can translate pkcs10 to PEM) |
| file     | csr              | certificate signing request                                                         | pkcs10; contains of subject, org, state, public key;to be signed                                                                                                                                           |
| standard | p7,pkcs7         | standard for signing or encrypting (officially called "enveloping") data; keystore; |
| standard | pkcs12, pfx, p12 |                                                                                     | password protected ***container*** format; contains both pub, pri;pem<->pkcs12                                                                                                                             |
| file     | cert,cer,crt     |                                                                                     | certificate; pem format; extension only recognized by windows                                                                                                                                              |
| file     | p7b,keystore,jks |                                                                                     | pkcs7; for certificate exchange; p7b understand by Windows; keystore/jks understand by java; no private key                                                                                                |

### X.509

<https://stackoverflow.com/questions/38976885/difference-between-x-509-and-pem/38977354>

#### Certificate

-----BEGIN CERTIFICATE-----
MIIEITCCA+CgAwIBAgIUKMmxmDbjbHqt+Yzwj5lflBxuQwEwCQYHKoZIzjgEAzAjMSEwHwYDVQQD
ExhUb2tlbiBTaWduaW5nIFB1YmxpYyBLZXkwHhcNMTIxMTE2MTgzODMwWhcNMTIxMTIzMTgzODMw
WjAtMSswKQYDVQQDHiIAYgBiADEANAAxADkAYQAyAGMAZgBjADEAZQAwADAAOAAAMIGfMA0GCSqG
<...>
-----END CERTIFICATE-----

#### Certificate Revocation List

-----BEGIN X509 CRL-----
MIIDBjCCAm8CAQAwcTERMA8GA1UEAxMIcXV1eC5jb20xDzANBgNVBAsTBkJyYWlu
czEWMBQGA1UEChMNRGV2ZWxvcE1lbnRvcjERMA8GA1UEBxMIVG9ycmFuY2UxEzAR
BgNVBAgTCkNhbGlmb3JuaWExCzAJBgNVBAYTAlVTMIGfMA0GCSqGSIb3DQEBAQUA
<...>
-----END X509 CRL-----

#### Certificate Request

-----BEGIN NEW CERTIFICATE REQUEST-----
MIIDBjCCAm8CAQAwcTERMA8GA1UEAxMIcXV1eC5jb20xDzANBgNVBAsTBkJyYWlu
czEWMBQGA1UEChMNRGV2ZWxvcE1lbnRvcjERMA8GA1UEBxMIVG9ycmFuY2UxEzAR
BgNVBAgTCkNhbGlmb3JuaWExCzAJBgNVBAYTAlVTMIGfMA0GCSqGSIb3DQEBAQUA
<...>
-----END NEW CERTIFICATE REQUEST-----

#### PKCS#1 private key

-----BEGIN RSA PRIVATE KEY-----
MIIDBjCCAm8CAQAwcTERMA8GA1UEAxMIcXV1eC5jb20xDzANBgNVBAsTBkJyYWlu
czEWMBQGA1UEChMNRGV2ZWxvcE1lbnRvcjERMA8GA1UEBxMIVG9ycmFuY2UxEzAR
BgNVBAgTCkNhbGlmb3JuaWExCzAJBgNVBAYTAlVTMIGfMA0GCSqGSIb3DQEBAQUA
<...>
-----END RSA PRIVATE KEY-----

#### PKCS#8 private key

-----BEGIN PRIVATE KEY-----
MIIDBjCCAm8CAQAwcTERMA8GA1UEAxMIcXV1eC5jb20xDzANBgNVBAsTBkJyYWlu
czEWMBQGA1UEChMNRGV2ZWxvcE1lbnRvcjERMA8GA1UEBxMIVG9ycmFuY2UxEzAR
BgNVBAgTCkNhbGlmb3JuaWExCzAJBgNVBAYTAlVTMIGfMA0GCSqGSIb3DQEBAQUA
<...>
-----END PRIVATE KEY-----

### Conversion

#### extract private key from jks

keytool -importkeystore -srckeystore signing.hc-dev-rsa-careshieldlife.jks -destkeystore signing.hc-dev-rsa-careshieldlife.jks.p12 -deststoretype PKCS12  -srcstorepass password1234  -srcalias signing.hc-dev-rsa.careshieldlife.gov.sg     -deststorepass password1234     -destkeypass password1234
openssl pkcs12 -in signing.hc-dev-rsa-careshieldlife.jks.p12  -nodes -nocerts -out signing.hc-dev-rsa-careshieldlife.jks.p12.pem

#### generate public key from private key

openssl rsa -in signing.hc-dev-rsa-careshieldlife.jks.p12.pem -pubout > signing.hc-dev-rsa-careshieldlife.jks.p12.pem.pub
