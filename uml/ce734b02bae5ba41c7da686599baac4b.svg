<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="817px" preserveAspectRatio="none" style="width:1418px;height:817px;background:#FFFFFF;" version="1.1" viewBox="0 0 1418 817" width="1418px" zoomAndPan="magnify"><defs><filter height="300%" id="f1r1i3e0jrq9m0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="33" x2="33" y1="41.6094" y2="772.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="203" x2="203" y1="41.6094" y2="772.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="334" x2="334" y1="41.6094" y2="772.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="455.5" x2="455.5" y1="41.6094" y2="772.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="728" x2="728" y1="41.6094" y2="772.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1000" x2="1000" y1="41.6094" y2="772.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1333" x2="1333" y1="41.6094" y2="772.6406"/><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="52" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="12" y="26.5332">SPOP</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="52" x="5" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="12" y="793.1738">SPOP</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="188" x="107" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="174" x="114" y="26.5332">ClientJWKSEndpointServlet</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="188" x="107" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="174" x="114" y="793.1738">ClientJWKSEndpointServlet</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="46" x="309" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="316" y="26.5332">MOP</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="46" x="309" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="316" y="793.1738">MOP</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="33" x="437.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19" x="444.5" y="26.5332">BR</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="33" x="437.5" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19" x="444.5" y="793.1738">BR</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="130" x="661" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="668" y="26.5332">PortalLoginServlet</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="130" x="661" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="668" y="793.1738">PortalLoginServlet</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="154" x="921" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="928" y="26.5332">SingpassOIDCService</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="154" x="921" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="928" y="793.1738">SingpassOIDCService</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="146" x="1258" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1265" y="26.5332">SingPassAuthServlet</text><rect fill="#FEFECE" filter="url(#f1r1i3e0jrq9m0)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="146" x="1258" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1265" y="793.1738">SingPassAuthServlet</text><polygon fill="#A80036" points="191,69.9609,201,73.9609,191,77.9609,195,73.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="33" x2="197" y1="73.9609" y2="73.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="40" y="69.1045">request for jwks(sig, enc)</text><polygon fill="#A80036" points="44,100.3125,34,104.3125,44,108.3125,40,104.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="38" x2="202" y1="104.3125" y2="104.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="50" y="99.4561">return jwks(sig, enc)</text><polygon fill="#A80036" points="444,130.6641,454,134.6641,444,138.6641,448,134.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="334" x2="450" y1="134.6641" y2="134.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="341" y="129.8076">click login button</text><polygon fill="#A80036" points="716,161.0156,726,165.0156,716,169.0156,720,165.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456" x2="722" y1="165.0156" y2="165.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="463" y="160.1592">construct singpass authentication endpoint</text><polygon fill="#A80036" points="988,191.3672,998,195.3672,988,199.3672,992,195.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="728" x2="994" y1="195.3672" y2="195.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="735" y="190.5107">construct singpass authentication endpoint</text><polygon fill="#A80036" points="739,221.7188,729,225.7188,739,229.7188,735,225.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="733" x2="999" y1="225.7188" y2="225.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="745" y="220.8623">return singpass login url</text><polygon fill="#A80036" points="467,252.0703,457,256.0703,467,260.0703,463,256.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="727" y1="256.0703" y2="256.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="473" y="251.2139">instruct browser to redirect to singpass op</text><polygon fill="#A80036" points="44,282.4219,34,286.4219,44,290.4219,40,286.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="38" x2="455" y1="286.4219" y2="286.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="50" y="281.5654">redirect to singpass op</text><line style="stroke:#A80036;stroke-width:1.0;" x1="33" x2="75" y1="316.7734" y2="316.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="75" x2="75" y1="316.7734" y2="329.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="34" x2="75" y1="329.7734" y2="329.7734"/><polygon fill="#A80036" points="44,325.7734,34,329.7734,44,333.7734,40,329.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="40" y="311.917">login</text><polygon fill="#A80036" points="1321,356.125,1331,360.125,1321,364.125,1325,360.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="33" x2="1327" y1="360.125" y2="360.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="40" y="355.2686">response(state,code)</text><polygon fill="#A80036" points="1011,386.4766,1001,390.4766,1011,394.4766,1007,390.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1005" x2="1332" y1="390.4766" y2="390.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1017" y="385.6201">getIdToken</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1000" x2="1042" y1="420.8281" y2="420.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1042" x2="1042" y1="420.8281" y2="433.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001" x2="1042" y1="433.8281" y2="433.8281"/><polygon fill="#A80036" points="1011,429.8281,1001,433.8281,1011,437.8281,1007,433.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1007" y="415.9717">validateAuthenticationEndpointRequest</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1000" x2="1042" y1="464.1797" y2="464.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1042" x2="1042" y1="464.1797" y2="477.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001" x2="1042" y1="477.1797" y2="477.1797"/><polygon fill="#A80036" points="1011,473.1797,1001,477.1797,1011,481.1797,1007,477.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="1007" y="459.3232">generateClientAssertion</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1000" x2="1042" y1="507.5313" y2="507.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1042" x2="1042" y1="507.5313" y2="520.5313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001" x2="1042" y1="520.5313" y2="520.5313"/><polygon fill="#A80036" points="1011,516.5313,1001,520.5313,1011,524.5313,1007,520.5313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="1007" y="502.6748">get token endpoint json(clientAssertion, code)</text><polygon fill="#A80036" points="44,546.8828,34,550.8828,44,554.8828,40,550.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="38" x2="999" y1="550.8828" y2="550.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="50" y="546.0264">get token endpoint json(clientAssertion, code)</text><polygon fill="#A80036" points="988,577.2344,998,581.2344,988,585.2344,992,581.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="33" x2="994" y1="581.2344" y2="581.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="40" y="576.3779">return with token endpoint json</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1000" x2="1042" y1="611.5859" y2="611.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1042" x2="1042" y1="611.5859" y2="624.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001" x2="1042" y1="624.5859" y2="624.5859"/><polygon fill="#A80036" points="1011,620.5859,1001,624.5859,1011,628.5859,1007,624.5859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="1007" y="606.7295">validate response from token endpoint</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1000" x2="1042" y1="654.9375" y2="654.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1042" x2="1042" y1="654.9375" y2="667.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001" x2="1042" y1="667.9375" y2="667.9375"/><polygon fill="#A80036" points="1011,663.9375,1001,667.9375,1011,671.9375,1007,667.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="1007" y="650.0811">decrypt jwe(using client jwk endpoint "enc" private key)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1000" x2="1042" y1="698.2891" y2="698.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1042" x2="1042" y1="698.2891" y2="711.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001" x2="1042" y1="711.2891" y2="711.2891"/><polygon fill="#A80036" points="1011,707.2891,1001,711.2891,1011,715.2891,1007,711.2891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1007" y="693.4326">get token endpoint json</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1000" x2="1042" y1="741.6406" y2="741.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1042" x2="1042" y1="741.6406" y2="754.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001" x2="1042" y1="754.6406" y2="754.6406"/><polygon fill="#A80036" points="1011,750.6406,1001,754.6406,1011,758.6406,1007,754.6406" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1007" y="736.7842">get token endpoint json</text><!--MD5=[8467cb10e285717d16314c038c5400cc]
@startuml
SPOP -> ClientJWKSEndpointServlet: request for jwks(sig, enc)
ClientJWKSEndpointServlet -> SPOP: return jwks(sig, enc)
MOP -> BR:click login button
BR -> PortalLoginServlet: construct singpass authentication endpoint
PortalLoginServlet -> SingpassOIDCService: construct singpass authentication endpoint
SingpassOIDCService -> PortalLoginServlet: return singpass login url
PortalLoginServlet -> BR: instruct browser to redirect to singpass op
BR -> SPOP: redirect to singpass op
SPOP -> SPOP: login
SPOP -> SingPassAuthServlet: response(state,code)
SingPassAuthServlet -> SingpassOIDCService: getIdToken
SingpassOIDCService -> SingpassOIDCService: validateAuthenticationEndpointRequest
SingpassOIDCService -> SingpassOIDCService: generateClientAssertion
SingpassOIDCService -> SingpassOIDCService: get token endpoint json(clientAssertion, code)
SingpassOIDCService -> SPOP: get token endpoint json(clientAssertion, code)
SPOP -> SingpassOIDCService: return with token endpoint json
SingpassOIDCService -> SingpassOIDCService: validate response from token endpoint
SingpassOIDCService -> SingpassOIDCService: decrypt jwe(using client jwk endpoint "enc" private key)
SingpassOIDCService -> SingpassOIDCService: get token endpoint json
SingpassOIDCService -> SingpassOIDCService: get token endpoint json
@enduml

PlantUML version 1.2021.10(Mon Aug 30 21:43:48 SGT 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>